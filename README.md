# my_shell

my_shell缩写为“mysh”，用于辅助管理使用环境。

## 需求
【描述对此软件的需要，可以是具体的，也可以是抽象的，最好是抽象的，这样有多种功能实现余地】
【对于需求的描述，需要如实记录，后面要进行整理，不能出现缺漏和矛盾的地方】

* 进入某个环境（可以是文件夹、制定的名字）后，
  * 设置规定好的开发环境，比如环境变量。
  * 自动加入这个环境可以用到的脚本，允许用户自己定制。
  * 可以添加一些目标（比如文件、文件夹）的标签，并且显示允许的操作（有点类似于鼠标右键）。
  * 显示当前环境的状态，允许用户定制显示的状态。
  * 可以导入和使用不同机器的环境。

### 额外需求
* 针对Ubuntu系统，最好普适 Linux 系统。
* 必须向前兼容。
* 不影响到系统正常操作。

## 实现需求的功能
【这里描述实现需求的具体功能，一般只涉及到用户的动作和系统的反应，不包括技术如何实现，形成功能架构】
【对于功能的描述，要尽量采用完整的、可靠的、明确的、不矛盾的概念，比如说文件、服务器、画面等等，如果可以还要加入一些额外的要求，
错误处理、可靠性的具体要求等】

## 实现功能的框架、技术和模块
【这里描述实现上面功能的架构，形成系统架构，包括软硬件。】
【对于框架等描述，要按照标准的软硬件模型来描述，比如UML，不要用模糊的语义来说明。
需要知道如何划分模块，定义模块之间的接口，已经模块的技术实现方法】

1. 每个目标都可以有自己的设置。
2. 目标可以根据文件树形成包含关系。
   目标上面只有一个父。父可以有多个子。
3. 当前环境(myenv)在哪个目标内，就具有什么样的环境。

### 环境和名字
针对目标（文件夹、文件等）的配置
1. name ----> directory/file
2. 目录向上寻找
从此目录向上，找到的存在 .myenv 的配置。

3. 配置
通用配置
.myenv  -+-- kind         自己配置的类型        
         +-- bin/         自定义的程序          
         +-- source/      自定义的脚本在里面    
         +-- data/        自定义的数据在里面    

### 工具
1. myenv 主要是创建、跳转环境。是用一个进程实现的。
2. mysh 执行命令，为了能够影响到内部的变量，是一个 function 来实现的。
	但是它可以执行一个内部的function，或者外部的一个进程。
	为了不影响内部的环境，尽量使用外部的进程实现功能。

### 启动流程
1. 先分析命令参数。
2. 根据命令指定的版本，去初始化各种内部环境。【版本】
3. 根据用户的设定，按照版本来初始化环境。
4. 最后读取用户定制自己的脚本。【定制】

### 用户可以配置的项目
用户可以设定自己需要的初始化环境，以及可以使用的脚本。
然后定义自己的环境变量。
客户环境中的文件，工具只负责生成，而不要输入缺省的设置。

### 内部的版本管理机制
此软件为了支持向后兼容性，比如说之前的脚本，后面也将支持。
但是后面的设计肯定会和之前的不同，或者更多、或者更少。
所以必须提供脚本的版本管理，每个制定版本的脚本就按照此版本的体系运行。

1. 所有对外的接口都只能增加，不能减少或者修改。
2. 版本管理的前提是必须有统一的接口，只有定义一套统一的接口，且这套接口未来不会改变，
那么才能用版本管理有统一接口的多套不同的实现。

## 实现软件的支撑系统
【这里描述实现上面的系统时，需要提供的支撑系统，比如代码管理、开发平台、调试和测试平台、实施和维护方法，以及人员管理流程等，总之是围绕实现系统的周边系统】

## 目前的任务

1. 解决 按下 TAB 时，会出现错误。(OK)
	PATH 路径也有问题。
	-修改方法 : /usr/share/bash-completion/bash_completion 的 2058 行，加入 declare -A _xspecs.-
	-不知道为什么，这个 _xspecs 数组变成了 index array，所以索引不能输入带有"."的文字作为索引。-
	-declare -A 是声明为 association array，可以是任意字符串。-
	-问题应该没有真的解决。-
	shell中不再 source ~/.bashrc，避免了问题，上面也不用修改。但是alias之类的设定还需要自己加入。
2. 允许设置 env 中某个文件、文件夹相关的操作，和 context menu 类似。（可用）
	添加了 context 的命令，但是发现bash在处理复杂的数据结构时，力不从心。
3. 实现 myenv mysh <命令> 的功能。 (OK)
4. 脚本可以在不同的机器上运行，只要设定 <env name>@<machine>，然后执行就行。
    场景是用来使用远程服务器，分布使用，并且将一系列的工作放在一个脚本中运行。
	1. 可以公开某个机器的env，其他机器可以登录并使用。
	2. 脚本可以运行在任意环境中。参考 dsh，注意避免没有必要的繁琐实现。
5. 实现 search-do 模式，就是将 “search” 得到的结果，交给 “do” 去处理。
	最好能够在 bash 下都可以运行，不然只能定制一个 shell 程序了。
6. 独立运行程序，放在文件夹下面，可以立刻使用，而不是需要再进入系统中。(新的加载exe的方法就可以实现) OK
	function的同样。（没有妥善的方法，所以这个放弃。）
7. 实现 TAB 按下后，word complete 操作。
8. 可以复制某个环境的脚本设定等等。
   1. 比如nebula环境，在不同的机器上是相同的。 或者Alps环境，也是类似的。
9. 是否加入一个 IDE 环境，显示 某个目标的 context ?
   1.  目标的列表
   2.  目标的动作列表
   3.  目标的状态（现检查和之前保存下来的信息）
   4.  查询其他环境的目标情况。
   5.  多个环境的动作连动。


search-do
	1. 我们很多的动作都是先search，然后根据 search 的结果操作。
	2. 如果search慢，或者还需要再加工一下，比如手工加工，那么就会不容易操作。
	3. search-do ： 要有多次 search/filter/do 的过程。主要是保存中间的结果，
	这样就方便操作了。
	4. search-do 需要把内部执行的命令的导出都放入临时文件，然后下面一个命令就可以获取。
      	1. content -> do -> content
